# SmartSleep

SmartSleep는 Windows 10/11에서 마우스·키보드 입력, CPU 사용률, 네트워크 전송량을 통합적으로 감시하여 지정한 유휴 조건이 일정 시간 이상 지속되면 자동으로 절전 모드로 전환해 주는 트레이 애플리케이션입니다.

## 주요 기능
- 입력/CPU/네트워크 각각에 대해 사용 여부와 임계값(초, %, KB/s)을 세밀하게 설정
- CPU/네트워크 유휴 지속 시간 추적과 실시간 통계 표시
- 센서 스파이크를 완화하는 CPU·네트워크 이동 평균(기본 3샘플) 설정
- 유휴 상태가 지정한 시간 이상 유지될 때 자동 절전 요청
- 특정 시간대에만 모니터링하도록 스케줄 지정 가능 (자정 교차 구간 지원)
- 시스템 트레이 아이콘으로 상태 표시, 풍선 알림 제공
- Windows 시작 시 자동 실행 옵션 제공
- 설정 창을 제외하고 UI를 노출하지 않는 백그라운드 실행

## 빌드 & 실행
```powershell
# 처음 한 번만
dotnet restore

# 빌드
dotnet build

# 실행 (디버그 빌드 기준)
dotnet run --project src/SmartSleep.App
```
애플리케이션을 실행하면 트레이에 SmartSleep 아이콘이 표시되고, 설정 창은 트레이 아이콘을 더블클릭하거나 우클릭 > "설정 열기"를 선택하면 열립니다.

## 설정 항목
- **감시 시간대 입력 형식**: HH:mm (예: 22:30, 07:05) 형식으로 입력하고 '적용' 또는 '확인'을 눌러 저장합니다.
- **마우스/키보드 활동 사용**: 마지막 입력 이후 경과 시간이 지정한 초 이상일 때만 유휴로 판단합니다.
- **CPU 활동 사용**: 전체 CPU 사용률이 임계값 이하이면서 지정한 기간(초) 동안 유지될 때 유휴로 인정합니다.
- **네트워크 활동 사용**: 모든 활성 어댑터의 송·수신량(KB/s)이 임계값 이하이면서 지정한 기간(초) 동안 유지될 때 유휴로 인정합니다.
- **CPU 이동 평균 샘플 수 / 네트워크 이동 평균 샘플 수**: 센서 값을 부드럽게 만들기 위해 평균에 포함할 샘플 개수를 설정합니다.
- **모니터링 주기**: 센서를 갱신하는 주기(초)입니다.
- **절전 재시도 대기 (초):** 절전 명령 후 다시 시도하기 전 대기 시간으로, 최소 10초 이상 지정해야 합니다.
- **특정 시간에만 감시**: 체크하면 시작/종료 시각 사이에서만 모니터링합니다. 종료 시간이 시작 시간보다 빠른 경우 자정을 넘어 다음 날까지 감시합니다.
- **Windows 시작 시 자동 실행**: 사용자 레지스트리의 Run 키에 등록하여 자동 실행을 켜고 끌 수 있습니다.

설정을 저장하면 즉시 적용되며, `SmartSleep 실행 파일이 있는 폴더의 config.json`에 보관됩니다.

## 참고 사항
- 절전 모드 진입 실패 시 풍선 알림과 함께 오류 코드가 표시됩니다. 전원 관리 정책 또는 권한 문제일 수 있습니다.
- 네트워크 사용량은 IPv4 통계를 기준으로 계산되며, 가상 어댑터나 일부 특수 인터페이스는 제외됩니다.
- 테스트 환경에 따라 절전이 차단될 수 있으므로 Windows 전원 정책을 확인해 주세요.
